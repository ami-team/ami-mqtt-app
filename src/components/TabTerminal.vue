<!-- *************************************************************************************************************** -->

<script setup>

/*--------------------------------------------------------------------------------------------------------------------*/

import {ref, onMounted} from 'vue';

import {v4 as uuidV4} from 'uuid';

import createTerm from '../utilities/createTerm';

/*--------------------------------------------------------------------------------------------------------------------*/

const props = defineProps({
    id: {
        type: String,
        default: uuidV4(),
    },
    active: {
        type: Boolean,
        default: false,
    },
    clear: {
        type: Boolean,
        default: false,
    },
    prompt: {
        type: String,
        default: '',
    },
});

/*--------------------------------------------------------------------------------------------------------------------*/

const emit = defineEmits([
    'is-ready'
]);

/*--------------------------------------------------------------------------------------------------------------------*/

const divRef = ref(null);

/*--------------------------------------------------------------------------------------------------------------------*/

const term = createTerm();

/*--------------------------------------------------------------------------------------------------------------------*/

term.prompt = () => {

    term.clear();

    if(props.prompt)
    {
        term.write(props.prompt);
    }
}

/*--------------------------------------------------------------------------------------------------------------------*/

onMounted(() => {

    /*----------------------------------------------------------------------------------------------------------------*/

    document.querySelector(`button[data-bs-target="#${props.id}"]`).addEventListener('shown.bs.tab', () => term.fit());

    /*----------------------------------------------------------------------------------------------------------------*/

    term.open(divRef.value);

    /*----------------------------------------------------------------------------------------------------------------*/

    term.fit();

    if(props.prompt)
    {
        term.write(props.prompt);
    }

    /*----------------------------------------------------------------------------------------------------------------*/

    emit('is-ready', term);

    /*----------------------------------------------------------------------------------------------------------------*/
});

/*--------------------------------------------------------------------------------------------------------------------*/

</script>

<!-- *************************************************************************************************************** -->

<template>
    <div :class="`tab-pane fade ${props.active ? 'show active' : 'xxxx xxxxxx'} h-100`" :id="props.id" role="tabpanel" tabindex="0">

        <div class="h-100" ref="divRef"></div>

        <div class="d-flex position-absolute" style="top: 0.5rem; right: 1.0rem;">

            <slot></slot>

            <button class="btn btn-outline-dark text-dark" v-if="!props.clear">
                <i class="bi bi-trash"></i>
            </button>

            <button class="btn btn-outline-danger" @click="term.prompt" v-else>
                <i class="bi bi-trash"></i>
            </button>

        </div>

    </div>
</template>

<!-- *************************************************************************************************************** -->
